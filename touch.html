<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Contact Area Visualizer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            touch-action: none; /* Disables browser zooming/scrolling */
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* UI Controls */
        .ui-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 10px;
            box-sizing: border-box;
            background: rgba(255,255,255,0.9);
            border-bottom: 1px solid #ddd;
            z-index: 100;
        }

        .tabs {
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            background: #eee;
            border: 1px solid #ccc;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .tab-btn.active {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        .clear-btn {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 15px;
            font-weight: bold;
        }

        /* Stats HUD */
        .stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            pointer-events: none;
            font-family: monospace;
            background: rgba(0,0,0,0.7);
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }
    </style>
</head>
<body>

    <div class="ui-bar">
        <div class="tabs">
            <button class="tab-btn active" onclick="setMode(1)">1. Phantom</button>
            <button class="tab-btn" onclick="setMode(2)">2. Charcoal</button>
            <button class="tab-btn" onclick="setMode(3)">3. Aqua</button>
        </div>
        <button class="clear-btn" onclick="clearCanvas()">Clear</button>
    </div>

    <canvas id="canvas"></canvas>
    
    <div class="stats" id="stats">
        Touch Status: Idle<br>
        Radius X: 0<br>
        Radius Y: 0<br>
        Rotation: 0°
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { alpha: false }); // Optimize for speed
        const stats = document.getElementById('stats');
        
        let mode = 1;
        
        // Handle resizing
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            clearCanvas();
        }
        window.addEventListener('resize', resize);
        resize();

        function setMode(m) {
            mode = m;
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i + 1 === m);
            });
            clearCanvas();
        }

        function clearCanvas() {
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // --- THE CORE LOGIC ---
        function handleTouch(e) {
            e.preventDefault(); // Stop scrolling
            
            // Loop through all active fingers (multitouch support)
            for (let i = 0; i < e.touches.length; i++) {
                const t = e.touches[i];
                
                // 1. GET THE DATA
                // If the device doesn't support radius, fallback to 15px
                let rx = t.radiusX || 15;
                let ry = t.radiusY || 15;
                let rot = t.rotationAngle || 0;
                
                // Debug Display for first finger
                if (i === 0) {
                    stats.innerHTML = `
                        Touch Status: Active<br>
                        Radius X: ${rx.toFixed(1)}px<br>
                        Radius Y: ${ry.toFixed(1)}px<br>
                        Rotation: ${(rot * 180 / Math.PI).toFixed(1)}°
                    `;
                }

                // 2. RENDER BASED ON STRATEGY
                ctx.save();
                ctx.translate(t.clientX, t.clientY);
                ctx.rotate(rot); // Rotate the canvas to match finger angle

                if (mode === 1) { 
                    // === STRATEGY 1: PHANTOM (Wireframe/Solid) ===
                    // Draws the exact oval shape.
                    // Tip of finger = small oval.
                    // Squished thumb = large fat oval.
                    
                    ctx.beginPath();
                    ctx.ellipse(0, 0, rx, ry, 0, 0, 2 * Math.PI);
                    ctx.fillStyle = 'rgba(0, 0, 0, 1)'; // Solid black
                    ctx.fill();
                } 
                else if (mode === 2) {
                    // === STRATEGY 2: CHARCOAL (Scatter) ===
                    // Fills the contact area with random dots.
                    // Larger area (squish) = More dots.
                    
                    // Number of particles depends on pressure (area)
                    const area = rx * ry;
                    const particles = Math.floor(area / 5); 

                    ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                    
                    for(let p=0; p<particles; p++) {
                        // Generate random point inside the ellipse
                        // Math trick for random point in circle/ellipse
                        const angle = Math.random() * Math.PI * 2;
                        const r = Math.sqrt(Math.random());
                        const px = r * Math.cos(angle) * rx;
                        const py = r * Math.sin(angle) * ry;
                        
                        ctx.fillRect(px, py, 1, 1);
                    }
                } 
                else if (mode === 3) {
                    // === STRATEGY 3: AQUA (Opacity Stack) ===
                    // Soft, transparent ovals.
                    // They layer on top of each other to create density.
                    
                    // We increase the size slightly to simulate ink bleed
                    const bleedX = rx * 1.2;
                    const bleedY = ry * 1.2;

                    // Create a soft gradient for the "stamp"
                    // Warning: Gradients can be slow, but look great
                    const grad = ctx.createRadialGradient(0, 0, 0, 0, 0, Math.max(bleedX, bleedY));
                    grad.addColorStop(0, 'rgba(0, 0, 255, 0.1)'); // Darker center
                    grad.addColorStop(1, 'rgba(0, 0, 255, 0)');   // Transparent edge

                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.ellipse(0, 0, bleedX, bleedY, 0, 0, 2 * Math.PI);
                    ctx.fill();
                }

                ctx.restore();
            }
        }

        // Attach listeners
        // We use { passive: false } to allow e.preventDefault()
        canvas.addEventListener('touchstart', handleTouch, { passive: false });
        canvas.addEventListener('touchmove', handleTouch, { passive: false });
        
        canvas.addEventListener('touchend', () => {
             stats.innerHTML = "Touch Status: Lifted";
        });

    </script>
</body>
</html>
